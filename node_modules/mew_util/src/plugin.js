var path = require("path");

var foundation = require("./foundation.js");
var home = require("./home.js");

var plugin = function (defintion, basePath) {

    var pair = defintion.split("@");

    var modulePath = null;
    var method = null;

    if (pair.length === 1) {
        modulePath = pair[0];
    } else {
        modulePath = pair.slice(1).join("@");
        method = pair[0];
    }

    var finalPath = null;

    if (!basePath) {
        basePath = process.cwd();
    }

    try {
        finalPath = home.resolveModule(module, path.join(basePath, modulePath));
    } catch (error) {
        // Do nothing
    }

    if (!finalPath) {
        finalPath = home.resolveModule(module, modulePath);
    }

    if (method) {
        return home.requireModule(module, finalPath)[method];
    } else {
        return home.requireModule(module, finalPath);
    }

};

module.exports = {
    "factory": foundation.deprecated("factory", "plugin", plugin),
    "plugin": plugin
};
